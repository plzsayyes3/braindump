<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON to Table</title>
  <style>
    table {
      border-collapse: collapse;
      table-layout: fixed;
      width: 100%;
    }
    td {
      border: 1px solid rgb(156, 156, 156);
      padding: 8px;
    }
  </style>
</head>
<body>
<h2>Week</h2>
<table>
  <tbody id="tableBodyWeek">
    <!-- Table body will be dynamically populated with JSON data -->
  </tbody>
</table>
<h2>Month</h2>
<table>
  <tbody id="tableBodyMonth">
    <!-- Table body will be dynamically populated with JSON data -->
  </tbody>
</table>
<h2>Quarter</h2>
<table>
  <tbody id="tableBodyQuarter">
    <!-- Table body will be dynamically populated with JSON data -->
  </tbody>
</table>
<button onclick="generatePDF()">印刷プレビュー</button>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Retrieve JSON data from local storage
  var jsonDataWeek = localStorage.getItem('cardData1');
  var jsonDataMonth = localStorage.getItem('cardData2');
  var jsonDataQuarter = localStorage.getItem('cardData3');

  // Function to create table rows dynamically
  function createTableRows(data, tableBodyId) {
    var dataArray = JSON.parse(data);
    var tableBody = document.getElementById(tableBodyId);

    var titleRow = document.createElement('tr');
    var itemsRow = document.createElement('tr');

    dataArray.forEach(function(data) {
      // Add Title cell to title row
      var titleCell = document.createElement('td');
      titleCell.textContent = data.title;
      titleRow.appendChild(titleCell);

      // Add Items cell to items row
      var itemsCell = document.createElement('td');
      itemsCell.innerHTML = data.items.join('<br>');
      itemsRow.appendChild(itemsCell);
    });

    // Append the title and items rows to the table body
    tableBody.appendChild(titleRow);
    tableBody.appendChild(itemsRow);
  }

  // Populate Week table
  if (jsonDataWeek !== null) {
    createTableRows(jsonDataWeek, 'tableBodyWeek');
  } else {
    console.error('Week JSON data not found in local storage.');
  }

  // Populate Month table
  if (jsonDataMonth !== null) {
    createTableRows(jsonDataMonth, 'tableBodyMonth');
  } else {
    console.error('Month JSON data not found in local storage.');
  }

  // Populate Quarter table
  if (jsonDataQuarter !== null) {
    createTableRows(jsonDataQuarter, 'tableBodyQuarter');
  } else {
    console.error('Quarter JSON data not found in local storage.');
  }
});

function generatePDF() {
  // Create a new PDF document
  var pdf = new jsPDF();

  // Iterate through tables and add them to the PDF
  var tables = document.querySelectorAll('table');
  var yOffset = 20;

  tables.forEach(function(table, index) {
    var canvas = document.createElement('canvas');
    canvas.width = table.offsetWidth;
    canvas.height = table.offsetHeight;
    var context = canvas.getContext('2d');

    // Draw the table content on the canvas
    context.fillStyle = '#ffffff';
    context.fillRect(0, 0, canvas.width, canvas.height);
    context.font = '12px Arial';
    context.fillStyle = '#000000';

    // Draw each cell of the table on the canvas
    var cells = table.querySelectorAll('td');
    var cellHeight = 20; // Adjust as needed
    cells.forEach(function(cell, cellIndex) {
      context.fillText(cell.textContent, cell.offsetLeft + 5, cell.offsetTop + cellHeight);
    });

    // Add the canvas as an image to the PDF
    pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 20, yOffset, canvas.width / 4, canvas.height / 4);

    // Adjust the yOffset for the next table
    yOffset += canvas.height / 4 + 10;
    
    // Add a new page for the next table
    if (index < tables.length - 1) {
      pdf.addPage();
    }
  });

  // Save the PDF
  pdf.save('output.pdf');
}
</script>

</body>
</html>
