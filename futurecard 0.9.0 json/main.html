<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
  <title>Future Card</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Zen Maru Gothic', sans-serif; /* Zen Maru Gothicã‚’ãƒ•ã‚©ãƒ³ãƒˆã«æŒ‡å®š */
    }

    .line {
      font-family: 'Zen Maru Gothic', sans-serif; /* Zen Maru Gothicã‚’ãƒ•ã‚©ãƒ³ãƒˆã«æŒ‡å®š */
      background-color: #d1e2ec6c;
      padding: 8px;
      padding-left: 10px;
    }

    .create-button {
      background-color: #bbcfdd10;
      color: #344364;
      padding: 10px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      line-height: 1.5;
      border-radius: 3px;
    }

    .card-container {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding: 9px;
      gap: 10px;
      cursor: grab;
      user-select: none;
    }

    .card {
      min-width: 250px;
      background-color: #ddf6ff;
      border-radius: 8px;
      padding: 10px;
      box-sizing: border-box;
      position: relative;
      cursor: pointer;
    }

    .title,
    .list-container {
      cursor: pointer;
    }

    .editable {
      padding: 5px;
      margin: 5px 0;
    }

    .list-item {
      padding: 5px 0;
    }

    .combined-text {
      width: 100%;
      box-sizing: content-box;
      margin-bottom: 10px;
      border: none;
      background-color: #ddf6ff;
      min-height: 20px;
      resize: none; /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§ã‚µã‚¤ã‚ºå¤‰æ›´ã§ããªã„ã‚ˆã†ã«è¨­å®š */
      overflow-y: hidden; /* ç¸¦æ–¹å‘ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éè¡¨ç¤ºã« */
    }

    .textarea {
      padding: 100px;
    }

    .preview-mode {
      display: none;
    }

    .selected-card {
      border: 2px solid #1056b15b;
    }

    .card.dragging {
      cursor: grabbing;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="line">
      ã€€WEEKã€€
      <button class="create-button" onclick="addCard('cardData1')">ï¼‹</button>
      <button class="create-button" onclick="moveSelectedCardLeft()">â—€</button>
      <button class="create-button" onclick="moveSelectedCardRight()">â–¶</button>
      <button class="create-button" onclick="saveToJSON('cardData1')">ğŸ’¾</button>
      <button class="create-button" onclick="deleteSelectedCard()">ğŸ—‘ï¸</button>
    </div>
  </div>

  <div class="card-container" id="cardContainer1">
    <!-- ã‚«ãƒ¼ãƒ‰è¦ç´ ã‚’è¿½åŠ  (View 1) -->
  </div>

  <div class="line">
    ã€€MONTHã€€
    <button class="create-button" onclick="addCard('cardData2')">ï¼‹</button>
    <button class="create-button" onclick="moveSelectedCardLeft()">â—€</button>
    <button class="create-button" onclick="moveSelectedCardRight()">â–¶</button>
    <button class="create-button" onclick="saveToJSON('cardData2')">ğŸ’¾</button>
    <button class="create-button" onclick="deleteSelectedCard()">ğŸ—‘ï¸</button>
  </div>

  <div class="card-container" id="cardContainer2">
    <!-- ã‚«ãƒ¼ãƒ‰è¦ç´ ã‚’è¿½åŠ  (View 2) -->
  </div>

  <div class="line">
    ã€€QUATERã€€
    <button class="create-button" onclick="addCard('cardData3')">ï¼‹</button>
    <button class="create-button" onclick="moveSelectedCardLeft()">â—€</button>
    <button class="create-button" onclick="moveSelectedCardRight()">â–¶</button>
    <button class="create-button" onclick="saveToJSON('cardData3')">ğŸ’¾</button>
    <button class="create-button" onclick="deleteSelectedCard()">ğŸ—‘ï¸</button>
  </div>

  <div class="card-container" id="cardContainer3">
    <!-- ã‚«ãƒ¼ãƒ‰è¦ç´ ã‚’è¿½åŠ  (View 3) -->
  </div>


  <script>
    // åˆå›èµ·å‹•æ™‚ã«JSONãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
    document.addEventListener('DOMContentLoaded', () => {
      loadCards('cardData1', 'cardContainer1');
      loadCards('cardData2', 'cardContainer2');
      loadCards('cardData3', 'cardContainer3');
    });
  
    // ã‚«ãƒ¼ãƒ‰ã‚’å·¦ã«ç§»å‹•ã™ã‚‹é–¢æ•°
    function moveSelectedCardLeft() {
      const selectedCard = document.querySelector('.selected-card');
      if (!selectedCard) return; // é¸æŠã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ãŒãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
  
      const cardContainer = selectedCard.parentNode;
      const prevCard = selectedCard.previousElementSibling;
      if (!prevCard) return; // å·¦ã«ç§»å‹•ã§ãã‚‹ã‚«ãƒ¼ãƒ‰ãŒãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
  
      cardContainer.insertBefore(selectedCard, prevCard);
      saveToJSON(cardContainer.id);
    }
  
    // ã‚«ãƒ¼ãƒ‰ã‚’å³ã«ç§»å‹•ã™ã‚‹é–¢æ•°
    function moveSelectedCardRight() {
      const selectedCard = document.querySelector('.selected-card');
      if (!selectedCard) return; // é¸æŠã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ãŒãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
  
      const cardContainer = selectedCard.parentNode;
      const nextCard = selectedCard.nextElementSibling;
      if (!nextCard) return; // å³ã«ç§»å‹•ã§ãã‚‹ã‚«ãƒ¼ãƒ‰ãŒãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
  
      cardContainer.insertBefore(nextCard, selectedCard);
      saveToJSON(cardContainer.id);
    }
  
      // ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°
      function deleteSelectedCard() {
        const selectedCard = document.querySelector('.selected-card');
        if (!selectedCard) return; // é¸æŠã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ãŒãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„

        // å‰Šé™¤ã®ç¢ºèªã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ±‚ã‚ã‚‹
        const isConfirmed = confirm('ã“ã®ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');
        if (isConfirmed) {
          const cardContainer = selectedCard.parentNode;
          cardContainer.removeChild(selectedCard);
          saveToJSON(cardContainer.id);
        }
      }
  
    function addCard(storageKey) {
      const cardContainer = document.getElementById(`cardContainer${storageKey.slice(-1)}`);
  
      const newCard = document.createElement('div');
      const newId = new Date().getTime();
      newCard.className = 'card';
      newCard.setAttribute('data-id', newId);
  
      const title = document.createElement('div');
      title.className = 'title editable';
      title.textContent = 'New Card Title';
      title.setAttribute('contenteditable', 'true');
      title.addEventListener('input', () => saveContent(title, newId, storageKey));
  
      const combinedText = document.createElement('textarea');
      combinedText.className = 'combined-text editable';
      combinedText.textContent = 'New Item';
      combinedText.setAttribute('contenteditable', 'true');
      combinedText.addEventListener('input', () => saveContent(combinedText, newId, storageKey));
  
      newCard.appendChild(title);
      newCard.appendChild(combinedText);
  
      // ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
      newCard.addEventListener('click', () => selectCard(newCard));
  
      cardContainer.appendChild(newCard);
    }
  
    function loadCards(storageKey, containerId) {
      const cardContainer = document.getElementById(containerId);
      const savedData = localStorage.getItem(storageKey);
  
      if (savedData) {
        const cards = JSON.parse(savedData);
        cards.forEach(cardData => {
          addCardToContainer(cardData, cardContainer);
        });
      } else {
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
        addCardToContainer(null, cardContainer, storageKey);
      }
    }
  
    function addCardToContainer(data, container, storageKey) {
      const newCard = document.createElement('div');
      const newId = data ? data.id : new Date().getTime();
      newCard.className = 'card';
      newCard.setAttribute('data-id', newId);
  
      const title = document.createElement('div');
      title.className = 'title editable';
      title.textContent = data ? data.title : 'New Card Title';
      title.setAttribute('contenteditable', 'true');
      title.addEventListener('input', () => saveContent(title, newId, storageKey));
  
      const combinedText = document.createElement('textarea');
      combinedText.className = 'combined-text editable';
      combinedText.textContent = data ? data.items.join('\n') : 'New Item';
      combinedText.setAttribute('contenteditable', 'true');
      combinedText.addEventListener('input', () => saveContent(combinedText, newId, storageKey));
  
      newCard.appendChild(title);
      newCard.appendChild(combinedText);
  
      // ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
      newCard.addEventListener('click', () => selectCard(newCard));
  
      container.appendChild(newCard);
    }
  
    function enterEditMode(element) {
      element.setAttribute('contenteditable', 'true');
      element.classList.add('editable');
      element.focus();
    }
  
    function saveContent(element, id, storageKey) {
      // ãƒ‡ãƒ¼ã‚¿ã‚’JSONã«ä¿å­˜ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 
      saveToJSON(storageKey);
    }
  
    function saveToJSON(storageKey) {
      const cardContainer = document.getElementById(`cardContainer${storageKey.slice(-1)}`);
      const cards = [];
  
      cardContainer.querySelectorAll('.card').forEach(card => {
        const cardData = {
          id: card.getAttribute('data-id'),
          title: card.querySelector('.title').textContent,
          items: card.querySelector('.combined-text').value.split('\n')
        };
        cards.push(cardData);
      });
  
      const jsonData = JSON.stringify(cards);
      console.log(jsonData);
  
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      localStorage.setItem(storageKey, jsonData);
    }
  
    function handleKeyDown(event) {
      if (event.key === 'Escape') {
        const editableElement = document.querySelector('.editable[contenteditable="true"]');
        if (editableElement) {
          if (event.shiftKey) {
            // ã‚·ãƒ•ãƒˆã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
            enterPreviewMode();
          } else {
            editableElement.blur();
          }
        }
      }
    }
  
    function enterPreviewMode() {
      const cardContainer = document.querySelector('.card-container');
      cardContainer.querySelectorAll('.editable').forEach(element => {
        element.classList.add('preview-mode');
      });
    }
  
    function exitPreviewMode() {
      const cardContainer = document.querySelector('.card-container');
      cardContainer.querySelectorAll('.editable').forEach(element => {
        element.classList.remove('preview-mode');
      });
    }
  
    document.addEventListener('keydown', handleKeyDown);
  
    // ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ‰ãƒ©ãƒƒã‚°é–¢é€£ã®å‡¦ç†ã‚’è¿½åŠ 
    const cardContainers = document.querySelectorAll('.card-container');
  
    cardContainers.forEach(cardContainer => {
      cardContainer.addEventListener('wheel', (event) => {
        // ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã®å‹•ãã«åˆã‚ã›ã¦æ¨ªã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        cardContainer.scrollLeft += event.deltaY;
        // ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–
        event.preventDefault();
      });
  
      // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã®æŒ™å‹•
      let isDragging = false;
      let startX;
      let scrollLeft;
  
      cardContainer.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.pageX - cardContainer.offsetLeft;
        scrollLeft = cardContainer.scrollLeft;
  
        // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã«ã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸
        cardContainer.classList.add('dragging');
      });
  
      cardContainer.addEventListener('mouseleave', () => {
        // ãƒã‚¦ã‚¹ãŒã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã‚’é›¢ã‚ŒãŸã‚‰ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†
        isDragging = false;
        cardContainer.classList.remove('dragging');
      });
  
      cardContainer.addEventListener('mouseup', () => {
        // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†
        isDragging = false;
        cardContainer.classList.remove('dragging');
      });
  
      cardContainer.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        e.preventDefault();
        const x = e.pageX - cardContainer.offsetLeft;
        const walk = (x - startX) * 2; // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦ã®èª¿æ•´
  
        // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‡¦ç†
        cardContainer.scrollLeft = scrollLeft - walk;
      });
    });
  
    function selectCard(selectedCard) {
      // ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰ã‹ã‚‰é¸æŠçŠ¶æ…‹ã‚’è§£é™¤
      document.querySelectorAll('.card').forEach(card => {
        card.classList.remove('selected-card');
      });
  
      // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã«é¸æŠçŠ¶æ…‹ã‚’ä»˜ä¸
      selectedCard.classList.add('selected-card');
    }
  
    function toggleMenu() {
      const menuDropdown = document.getElementById('menuDropdown');
      menuDropdown.classList.toggle('active');
    }
  
    // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã¨ãã«å®Ÿè¡Œã™ã‚‹é–¢æ•°ã‚’è¿½åŠ 
    document.addEventListener('DOMContentLoaded', () => {
      // å…¨ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«ã¤ã„ã¦å‡¦ç†ã‚’è¡Œã†
      document.querySelectorAll('.combined-text').forEach(textarea => {
        // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®é«˜ã•ã‚’è‡ªå‹•èª¿æ•´ã™ã‚‹é–¢æ•°ã‚’å®Ÿè¡Œ
        autoAdjustTextareaHeight(textarea);
        // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å†…å®¹ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«é«˜ã•ã‚’å†èª¿æ•´ã™ã‚‹ã‚ˆã†ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
        textarea.addEventListener('input', () => autoAdjustTextareaHeight(textarea));
      });
    });
  
    // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®é«˜ã•ã‚’è‡ªå‹•èª¿æ•´ã™ã‚‹é–¢æ•°
    function autoAdjustTextareaHeight(textarea) {
      // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®é«˜ã•ã‚’å†…å®¹ã«åˆã‚ã›ã¦è‡ªå‹•èª¿æ•´
      textarea.style.height = 'auto';
      textarea.style.height = textarea.scrollHeight + 'px';
    }
  </script>  
</body>
</html>
